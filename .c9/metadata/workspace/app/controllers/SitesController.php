{"filter":false,"title":"SitesController.php","tooltip":"/app/controllers/SitesController.php","undoManager":{"mark":0,"position":0,"stack":[[{"group":"doc","deltas":[{"start":{"row":4,"column":0},"end":{"row":5,"column":0},"action":"remove","lines":["use FeelRank\\Services\\DiscussionService;",""]},{"start":{"row":4,"column":0},"end":{"row":5,"column":0},"action":"insert","lines":["use FeelRank\\Services\\DiscussionService;",""]}]}],[{"group":"doc","deltas":[{"start":{"row":24,"column":0},"end":{"row":60,"column":2},"action":"remove","lines":["\t\t$input = Input::all();","\t\t","\t\t$url_parts = parse_url($input['url']);","\t\t$host = $url_parts['host'];","\t\t","\t\t$site = new Post();","\t\t","\t\t$site->id = $this->Url64Service->urlTo64BitHash($input['url']);","\t\t$site->url = urlencode($input['url']);","\t\t$site->title = $this->getTitle($input['url']);","\t\t$site->description = '';","\t\t$site->source = $host;","\t\t","\t\t//$img = '/public/img/' . $site->id . 'thumbnail.png';","\t\t//file_put_contents($img, file_get_contents($this->UrlboxConnector->getImg($input['url'])));","\t\t","\t\t// Extract this code to a handler injected into repo","\t\t\t","\t\t$dirname = dirname('img/' . $site->id . '/thumbnail.png');","\t\t\t","\t\tif (!is_dir($dirname))","\t\t{","\t\t    mkdir($dirname, 0755, true);","\t\t}","\t\t","\t\t$ch = curl_init($this->UrlboxConnector->getImg($input['url']));","\t\t$fp = fopen('img/' . $site->id . '/thumbnail.png', 'wb');","\t\tcurl_setopt($ch, CURLOPT_FILE, $fp);","\t\tcurl_setopt($ch, CURLOPT_HEADER, 0);","\t\tcurl_exec($ch);","\t\tcurl_close($ch);","\t\tfclose($fp);","\t\t","\t\t$site->thumbnail = '';","\t\t","\t\tAuth::user()->posts()->save($site);","\t\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":24,"column":0},"end":{"row":25,"column":0},"action":"insert","lines":["",""]}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":96,"column":6},"end":{"row":96,"column":6},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1419217651524,"hash":"12df2ae6b854e5c0cafb60b35befe001d3702ad9"}